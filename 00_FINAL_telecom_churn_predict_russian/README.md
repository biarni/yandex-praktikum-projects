# Определение вероятности ухода клиентов из телеком компании и максимизация выручки

Управление клиентской базой имеет огромное значение для компании, оказывающей услуги в области телекоммуникаций. Очевидно, что отток клиентов негативно влияет на выручку компании. Согласно данным, предоставленным заказчиком, в то время как **отток клиентов за 4 последних месяца составил 1869 клиентов** (это весь отток клиентов в предоставленных данных или 26,5% от общего числа клиентов на момент среза данных), **приток новых составил только 464 клиента.**

## Цель проекта

1. Провести анализ данных и разработать модель машинного обучения для определения клиентов, склонных уйти из компании в ближайшее время (задача классификации), что позволит предложить ему специальные условия и избежать падения клиентской базы, выручки и прибыли компании.
2. Предложить механизм расчета влияния предложения скидок конкретным клиентам, вероятности ухода которых предсказала модель, на выручку компании с целью ее максимизации.
3. Составить портрет клиента, склонного к уходу, для дальнейшего маркетингового и продуктового анализа.

**План работ (этапы выполнения):**
1. Обзор данных и их предварительный анализ.  
2. Подготовка данных для исследовательского анализа.  
3. Исследовательский анализ данных с выявлением факторов, могущих влиять на отток клиентов.  
4. Статистическая проверка гипотез.
5. Разработка модели, подбор гиперпараметров на тренировочной выборке с использованием кросс-валидации.  
6. Тестирование модели на тестовой выборке.  
7. Интерпретация результатов.  

## Примененные инструменты
Matplotlib, NumPy, Pandas, Python, SciPy, Scikit-learn, CatBoost.

## Отработанные навыки
Обработка данных, пропуски, группировка, сортировка, исследовательский анализ данных, описательная статистика, проверка статистических гипотез, Машинное обучениеб настройка порога классификации для максимизации выручки.

## Вывод

**Подбор гиперпараметров и выбор модели:**

**Логистическая регрессия** на выборке с полным набором признаков дала значение метрики ROC-AUC чуть выше (0,86), чем на наборе признаков, из которого удалены месячная и общая выручку, чтобы избежать мультиколлинеарности (0,85).  
Для **CatBoostClassifier** поиск лучших гиперпараметров проведен в несколько этапов. Для всех этапов была выбрана функция потерь Logloss и коэффицент обучения 0,1. Остальные переметры находились в следующих диапазонах (по этапас):
1. Глубина деревьев от 1 до 5 с шагом 1; количество от 900 до 1080 с шагом 20.
2. Глубина деревьев от 4 до 7 с шагом 1; количество от 1000 до 1350 с шагом 50.
3. Глубина деревьев от 1 до 3 с шагом 1; количество от 1800 до 2900 с шагом 100.
4. Глубина деревьев 2; количество от 2900 до 4900 с шагом 100.   
Отмечено, что количество итераций больше улучшает модель, чем глубина.

Лучшие результаты показала модель CatBoostClassifier с функцией потерь Logloss, коэффицентом обучения 0,1, глубиной деревьев 2, количеством 4500 - **лучшая метрика ROC-AUC составила 0.923**.

**Тестирование:**

На тестовой выборке значения метрик лучшей модели составили:
- ROC-AUC - 0.93
- Accuracy - 0.89
- Recall - 0.74

**Интерпретация результатов для максимизации выручки**

Классификация по основной метрике ROC-AUC в среднем отнесла к первому классу клиентов с вероятностью выше 27,4%, это примерно соответствует доле целевого класса в выборке (26,5%). Так работает классификация с помощью выбранного инструмента sklearn roc_auc_score (оценки вероятности при классификации примерно соответствуют вероятности класса с большей меткой, класса 1). 

Вместе с тем, как отмечали выше, негативное влияние на выручку ухода клиента выше, чем негативное влияния преложения скидок. И хотя точность калссификации также высока - она касается предсказаний для обоих классов клиентов. Однако, главное для нас полнота выявления клиентов, склонных к уходу.

В работе выполнен подбор иного, ручного порога вероятности отнесения клиентов к целевому классу, выше которого следует считать клиентов склонными к уходу, исходя из максимизации выручки компании. Расчеты выполнены на основе матрицы ошибок для каждого порога (истинно-положительные, ложно-положительные, ложно-отрицательные и истинно-отрицательные предсказания). 

Расчет проведен на примере месячной выручки (ушедшие клиенты - средний чек 74 доллара, оставшиеся - 61 доллар в соответствии с историческими данными). **С целью дополнительного подтверждения указанной разницы проведено статистическое тестирование, которое показало, что вероятность случайной разницы в средних чеках на выборках крайне мала.**

С другой стороны, в расчет включено предложение скидок разного размера (5%, 10%, 20%, 50%) на месячный платеж всем клиентам, классифицированным как целевой класс:
1. Размер скидки 5%, наибольшая выручка - 113123.45, порог наибольшей выручки - 0.152602.
2. Размер скидки 10%, наибольшая выручка - 108546.9, порог наибольшей выручки - 0.152602.
3. Размер скидки 20%, наибольшая выручка - 99395.8, порог наибольшей выручки - 0.134607.
4. Размер скидки 50%, наибольшая выручка - 72157.5, порог наибольшей выручки - 0.087908.

Предлагается для данных расчетов с предложенными параметрами использовать в качестве промо предложение скидки в 5% или 10%. При этом скидки не нужно предлагать слишком большие - и 5% и 10% дает один и тот же порог и одно и тоже количество потенциально ушедших клиентов (полнота выявления), а выручка при 5% скидке выше. Разумеется, остается вопрос - какой размер скидки надежнее удержит клиента. 

При этом, с учетом расходов на удержание - скидки не нужно предлагать слишком многим, - значение Recall не максимальное, хотя и очень высокое (0,92). При этом, значение Accuracy (точности для обоих классов) снизилось - мы настроили порог так, что модель относит к целевому классу больше клиентов, в том числе не относящихся к нему. Однако, с точки зрения бизнеса такое значение оптимально.

Справочно, иллюстрация логики с точки зрения значения дополнительных интерпретируемых метрик. Изменения метрик в зависимости от значения порога:
1. Значение порога 0.01, ROC-AUC 0.93, Accuracy 0.45, Recall 0.99. Выявляем 99% целевого класса, однако точность для обоих классов очень низкая, а значит скидки буду предложены большому числу лояльных клиентов - значение выручки неоптимально.
2. Значение порога 0.152602, ROC-AUC 0.93, Accuracy 0.79, Recall 0.92. Выявляем 92% целевого класса, точность для обоих классов приемлема, значение выручки **оптимально**.
3. Значение порога 0.9, ROC-AUC 0.93, Accuracy 0.84, Recall 0.42. Выявляем всего 42% целевого класса, однако точность для обоих классов высокая, а значит скидки буду предложены меньшему числу лояльных клиентов. Однако, ушедших клиентов будет больше и больше негативного влияния на выручку - значение выручки неоптимально.

Подобные расчеты и настройка попрога вероятности классификации клиентов могут быть выполнены и для иных маркетинговых акций - предложения разовых промокодов, скидок на иной период (например, три месяца, в данном расчете - период скидок один месяц), бесплатную техподдержку или изменения типа подключения к интернету (при предоставлении дополнительных данных об исторических удельных расходах на предоставление указанных услуг), а также адаптированы под иную бизнес-логику.

**По результатм исследовательского анализа данных** получен нижеследующий портрет клиента, склонного к уходу на основании различий в долях по различным показателям среди ушедших и оставшихся клиентов.  

1. По личным данным клиентов:
- среди ушедших больше пожилых - 25%/13%;
- среди ушедших меньше имеющих иждивенцев - 17%/34%;
- среди ушедших меньше имеющих партнера - 36%/53%.
2. По подключенным услугам:
- среди ушедших больше пользователей интернета - 94%/73%;
- среди ушедших больше пользователей Fiber optic - 69%/35%;
- среди ушедших меньше пользователей DSL - 25%/38%;
- среди ушедших меньше пользующихся техподдержкой - 17%/34%;
- среди ушедших меньше пользующихся услугами блокировки нежелательного контента - 16%/33%;
- среди ушедших меньше пользующихся услугами бэкапа - 28%/37%;
- среди ушедших меньше пользующихся услугами антивируса - 29%/36%.
3. По типам контрактов и оплаты:
- среди ушедших больше платящих электронными чеками - 57%/25%, среди других видов оплаты - 12-16% по сравнению c 25% по другим типам у оставшихся клиентов;
- среди ушедших больше с месячным типом контракта - 89%/43%, годовой тип контракта - 9%/25%, двухлетний - 2,6%/32%;
- среди ушедших больше получающих электронные чеки - 75%/54%.
4. По суммам оплаты:
- среди ушедших чуть больше средняя месячная сумма оплаты - 74/61 долларов;
- среди ушедших средняя общая сумма оплаты намного меньше - 1532/2550 долларов.
5. По сроку сотрудничества с компанией: среди ушедших средний срок почти в два раза ниже - 547/1144 дней.

**По результатам влияния различных признаков на результат предсказания модели машинного обучения** наиболее важными признаками, влияющими на склонность к уходу, оказались (в порядке убывания):
- срок, проведенный в компании;
- размер ежемесячной оплаты;
- размер общей оплаты;
- тип контракта (месячный, годовой или двухлетний);
- тип и наличие интернет-соединения;
- метод оплаты;
- наличие электронного выставления счета.

Данные исследовательского анализа данных и анализ важности признаков модели согласуются между собой.  
**Таким образом, ушедшие клиенты харакеризуются следующими главными чертами** (в порядке убывания важности):
1. Меньше времени являлись клиентами, средний срок почти в два раза ниже - 547/1144 дней.
2. Платили больше (в среднем в месяц 74 доллара против 61 доллара).
3. Предпочитали месячный тип контракта - 89%/43%.
4. Больше пользовались интернетом - 94%/73%, в основном Fiber optic (69%/35%), при этом заметно меньше пользовались техподдержкой и другими интернет-услугами.
5. Больше платили электронными чеками - 57%/25%.
6. Больше получали электронные чеки - 75%/54%.